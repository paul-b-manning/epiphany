# Epiphany

<!-- TOC -->

- [Epiphany](#epiphany)
    - [Overview](#overview)
    - [Known Issues](#known-issues)
    - [HOWTO documents](HOWTO.md)
  - [Git Workflow](#git-workflow)
  - [Dependencies](#dependencies)
  - [Help Wanted](#help-wanted)
  - [Epiphany Community](#epiphany-community)
  - [Security](#security)
  - [Automation](#automation)
  - [Storage](#storage)
  - [Reading materials on Epiphany components](#reading-materials-on-epiphany-components)

<!-- /TOC -->

## Overview

Epiphany at its core is a full automation of Kubernetes and Docker plus additional builtin services such as Kafka for high speed messaging/events, Prometheus for monitoring and Graphana for dashboards, Elasticsearch and Kibana for centralized logging. Other optional services are being evaluated now.

Epiphany can run on as few as one node (laptop, desktop, server) but the real value comes from running 3 or more nodes for scale and HA. Nodes can be added or removed at will depending on data in the manifest. Everything is data driven so simply changing the manifest data and running the automation will modify the environment.

We currently use Terraform and Ansible for our automation orchestration. All automation is idempotent so you can run it as many times as you wish and it will maintain the same state unless you change the data. If someone makes a "snow flake" change to the environment (you should never do this) then simply running the automation again will put the environment back to the desired state.

## Known Issues

The Terraform backend feature along with Azure Service Principal is the default configuration. This allows for multiple team members to modify the IaaS (VM) services on Azure. This works as expected from most networks. However, we have seen an error generated by Terraform on certain networks. This can be resolved simply by setting two options in the `data.yaml` file for your given environment. These are as follows:

```yaml
# Comments excluded here for clarity
terraform:
    service_principal:
        enable: false
    backend:
        enable: false
```

## Git Workflow

See [GITWORKFLOW.md](GITWORKFLOW.md).

## Dependencies

There are several required dependencies for the Epiphany automation to run from a 'workstation/deployment/bootstrap' node:

1. Docker
2. Ansible
3. jq (JSON Query tool: https://stedolan.github.io/jq/download/)
4. Python
5. Git
6. Azure CLI >= 2.0
7. SSH

We will create a Docker image that can be run that has all of this so that you will not be required to install anything unless you want to.

## Help Wanted

As in all community based projects, community participation is very important. We currently are building in Microsoft Azure under our Ability subscription. The plan is to do all building, testing, etc. in this subscription but allow you to clone this repo and run the automation to build out Epiphany within your own Azure subscription. Of course, you can use it for on-premise and other cloud platforms [coming soon].

So, to move faster we need more assistance from anyone willing to contribute. The contributions needed include development, QA, documentation, graphics, evangelism, and whatever else you believe would be good. The point is, Epiphany is open and welcomes all contributions from all divisions and BUs.

If interested then please see the [Contribution Guide](CONTRIBUTING.md).

## Epiphany Community

The plans are to have biweekly or monthly Microsoft Teams calls/videos on all things Epiphany. We may even do this weekly depending on interest. Think of it like 'office hours' where we may have a how-to session, open forum, round table talk, etc. There are no hard rules or predefined subjects. It will be driven by what you want.

## Security

Security is critical! Epiphany addresses security at multiple points. By default it establishes perimeter security via firewall rules, IPTables, etc. but it also incorporates cross platform Kubernetes Secrets.

Security enhancements will always be addressed. Epiphany will always comply with MCSR.

## Automation - TBD

## Storage

Microsoft Azure has a nice storage tool called [Storage Explorer](https://azure.microsoft.com/en-us/features/storage-explorer/). It can also be used with Visual Studio Code when using the builtin Azure Storage features.

## Reading materials on Epiphany components

Here are some materials concerning Epiphany components - both on what we use in the background and on what's available for you to use with your application/deployment. Links for every component are in an ascending order of complexity.

1. Under the hood
    1. [Terraform](https://www.terraform.io/)
        - AWS use case [example](https://www.terraform.io/intro/getting-started/build.html)
    2. [Ansible](https://www.ansible.com/)
        - [Intro to playbooks](https://docs.ansible.com/ansible/2.5/user_guide/playbooks_intro.html)
    3. [jq](https://stedolan.github.io/jq)
    4. [git-lfs](https://git-lfs.github.com/)
2. Available out of the box
    1. [Docker](https://www.docker.com/)
        - (Pluralsight) [Introduction to Docker and containerization](https://app.pluralsight.com/library/courses/docker-containers-big-picture/table-of-contents)
        - [A Beginner-Friendly Introduction to Containers, VMs and Docker](https://medium.freecodecamp.org/a-beginner-friendly-introduction-to-containers-vms-and-docker-79a9e3e119b)
    2. [Kubernetes](https://kubernetes.io/)
        - (Pluralsight) [Introduction to Kubernetes](https://app.pluralsight.com/library/courses/getting-started-kubernetes/table-of-contents)
        - [Kubernetes Basics](https://kubernetes.io/docs/tutorials/kubernetes-basics/)
        - (Free Udacity course) [Scalable Microservices with Kubernetes](https://www.udacity.com/course/scalable-microservices-with-kubernetes--ud615)
        - Curated list of [Kubernetes resources](https://legacy.gitbook.com/book/ramitsurana/awesome-kubernetes/details)
    3. Monitoring
        1. [Prometheus](https://prometheus.io/)
            - Query [examples](https://prometheus.io/docs/prometheus/latest/querying/examples/)
            - [Integration with Grafana](https://prometheus.io/docs/visualization/grafana/)
            - Included [OS mectric collector](https://github.com/prometheus/node_exporter)
            - Kafka monitoring with [JMX exporter](https://github.com/prometheus/jmx_exporter)
            - Alertmanager [Alerts from Prometheus](https://prometheus.io/docs/alerting/alertmanager/)
        2. [Grafana](https://grafana.com/)
            - Community supplied, ready to use [dashboards](https://grafana.com/dashboards)
    4. [Kafka](http://kafka.apache.org/)
        - [Kafka introduction](http://kafka.apache.org/intro)
        - (Pluralsight) [Getting Started with Apache Kafka](https://app.pluralsight.com/library/courses/apache-kafka-getting-started/table-of-contents)
    5. [RabbitMQ](https://www.rabbitmq.com/)
        - [RabbitMQ Getting started](https://www.rabbitmq.com/getstarted.html)
    6. Central logging
        1. [Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html)
        2. [Kibana](https://www.elastic.co/guide/en/kibana/current/index.html)
        3. [Filebeat](https://www.elastic.co/guide/en/beats/filebeat/current/index.html)
            - Beats platform reference(https://www.elastic.co/guide/en/beats/libbeat/current/index.html)
    7. Load Balancing
        1. [HaProxy](http://www.haproxy.org/)
    8. Databases
        1. [PostgreSQL](https://www.postgresql.org/docs/)
